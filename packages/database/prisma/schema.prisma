generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                                   String                 @id @default(uuid())
  email                                String                 @unique
  password_hash                        String
  first_name                           String
  last_name                            String
  role                                 UserRole               @default(STUDENT)
  avatar                               String?
  bio                                  String?
  is_active                            Boolean                @default(true)
  last_login_at                        DateTime?
  created_at                           DateTime               @default(now())
  updated_at                           DateTime
  ParentStudent_ParentStudent_ATousers ParentStudent[]        @relation("ParentStudent_ATousers")
  ParentStudent_ParentStudent_BTousers ParentStudent[]        @relation("ParentStudent_BTousers")
  assignment_submissions               AssignmentSubmission[]
  course_enrollments                   CourseEnrollment[]
  courses                              Course[]
  garden_rewards                       GardenReward[]
  gardens                              Garden[]
  ieps                                 IEP[]
  lesson_progress                      LessonProgress[]
  refresh_tokens                       refresh_tokens[]
  user_profiles                        user_profiles?

  @@map("users")
}

model Curriculum {
  id          String           @id @default(uuid())
  title       String
  description String?
  grade_level String
  subject     String
  status      CurriculumStatus @default(DRAFT)
  created_at  DateTime         @default(now())
  updated_at  DateTime
  courses     Course[]

  @@map("curricula")
}

model Course {
  id                 String             @id @default(uuid())
  title              String
  description        String?
  instructor_id      String
  curriculum_id      String?
  duration           Int?
  status             CourseStatus       @default(DRAFT)
  thumbnail_url      String?
  created_at         DateTime           @default(now())
  updated_at         DateTime
  assignments        Assignment[]
  course_enrollments CourseEnrollment[]
  curricula          Curriculum?        @relation(fields: [curriculum_id], references: [id])
  users              User               @relation(fields: [instructor_id], references: [id])
  lessons            Lesson[]

  @@map("courses")
}

model CourseEnrollment {
  id           String    @id @default(uuid())
  course_id    String
  student_id   String
  progress     Float     @default(0)
  enrolled_at  DateTime  @default(now())
  completed_at DateTime?
  courses      Course    @relation(fields: [course_id], references: [id], onDelete: Cascade)
  users        User      @relation(fields: [student_id], references: [id], onDelete: Cascade)

  @@unique([course_id, student_id])
  @@map("course_enrollments")
}

model Lesson {
  id              String           @id @default(uuid())
  course_id       String
  title           String
  content         String?
  order_index     Int
  duration        Int?
  type            LessonType       @default(TEXT)
  status          LessonStatus     @default(DRAFT)
  video_url       String?
  created_at      DateTime         @default(now())
  updated_at      DateTime
  lesson_progress LessonProgress[]
  courses         Course           @relation(fields: [course_id], references: [id], onDelete: Cascade)

  @@map("lessons")
}

model LessonProgress {
  id           String    @id @default(uuid())
  lesson_id    String
  student_id   String
  completed    Boolean   @default(false)
  score        Float?
  started_at   DateTime  @default(now())
  completed_at DateTime?
  lessons      Lesson    @relation(fields: [lesson_id], references: [id], onDelete: Cascade)
  users        User      @relation(fields: [student_id], references: [id], onDelete: Cascade)

  @@unique([lesson_id, student_id])
  @@map("lesson_progress")
}

model Assignment {
  id                     String                 @id @default(uuid())
  course_id              String
  title                  String
  description            String?
  due_date               DateTime?
  max_points             Int                    @default(100)
  status                 AssignmentStatus       @default(DRAFT)
  created_at             DateTime               @default(now())
  updated_at             DateTime
  assignment_submissions AssignmentSubmission[]
  courses                Course                 @relation(fields: [course_id], references: [id], onDelete: Cascade)

  @@map("assignments")
}

model AssignmentSubmission {
  id            String     @id @default(uuid())
  assignment_id String
  student_id    String
  content       String?
  file_url      String?
  score         Float?
  feedback      String?
  submitted_at  DateTime   @default(now())
  graded_at     DateTime?
  assignments   Assignment @relation(fields: [assignment_id], references: [id], onDelete: Cascade)
  users         User       @relation(fields: [student_id], references: [id], onDelete: Cascade)

  @@unique([assignment_id, student_id])
  @@map("assignment_submissions")
}

model IEP {
  id             String      @id @default(uuid())
  student_id     String
  title          String
  description    String?
  accommodations String[]
  start_date     DateTime
  end_date       DateTime
  status         IEPStatus   @default(DRAFT)
  created_at     DateTime    @default(now())
  updated_at     DateTime
  iep_goals      iep_goals[]
  users          User        @relation(fields: [student_id], references: [id], onDelete: Cascade)

  @@map("ieps")
}

model Garden {
  id          String   @id @default(uuid())
  student_id  String
  name        String
  description String?
  created_at  DateTime @default(now())
  updated_at  DateTime
  users       User     @relation(fields: [student_id], references: [id], onDelete: Cascade)
  plants      plants[]

  @@map("gardens")
}

model GardenReward {
  id          String     @id @default(uuid())
  student_id  String
  reward_type RewardType
  amount      Int        @default(1)
  reason      String
  earned_at   DateTime   @default(now())
  users       User       @relation(fields: [student_id], references: [id], onDelete: Cascade)

  @@map("garden_rewards")
}

model ParentStudent {
  A                            String
  B                            String
  users_ParentStudent_ATousers User   @relation("ParentStudent_ATousers", fields: [A], references: [id], onDelete: Cascade)
  users_ParentStudent_BTousers User   @relation("ParentStudent_BTousers", fields: [B], references: [id], onDelete: Cascade)

  @@id([A, B], map: "_ParentStudent_AB_pkey")
  @@index([B], map: "_ParentStudent_B_index")
  @@map("_ParentStudent")
}

model iep_goals {
  id          String        @id
  iep_id      String
  description String
  target_date DateTime
  progress    Float         @default(0)
  status      IEPGoalStatus @default(NOT_STARTED)
  notes       String?
  created_at  DateTime      @default(now())
  updated_at  DateTime
  ieps        IEP           @relation(fields: [iep_id], references: [id], onDelete: Cascade)
}

model plants {
  id           String         @id
  garden_id    String
  name         String
  type         GardenItemType @default(PLANT)
  level        Int            @default(1)
  xp           Int            @default(0)
  health       Int            @default(100)
  last_watered DateTime?
  created_at   DateTime       @default(now())
  updated_at   DateTime
  gardens      Garden         @relation(fields: [garden_id], references: [id], onDelete: Cascade)
}

model refresh_tokens {
  id         String   @id
  user_id    String
  token      String   @unique
  expires_at DateTime
  created_at DateTime @default(now())
  users      User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

model user_profiles {
  id          String   @id
  user_id     String   @unique
  preferences Json?
  settings    Json?
  created_at  DateTime @default(now())
  updated_at  DateTime
  users       User     @relation(fields: [user_id], references: [id], onDelete: Cascade)
}

enum UserRole {
  STUDENT
  TEACHER
  ADMIN
  PARENT
}

enum CurriculumStatus {
  DRAFT
  ACTIVE
  ARCHIVED
}

enum CourseStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum LessonStatus {
  DRAFT
  PUBLISHED
}

enum LessonType {
  VIDEO
  TEXT
  QUIZ
  ASSIGNMENT
}

enum AssignmentStatus {
  DRAFT
  PUBLISHED
  CLOSED
}

enum IEPStatus {
  DRAFT
  ACTIVE
  COMPLETED
  ARCHIVED
}

enum GardenItemType {
  FLOWER
  TREE
  PLANT
  DECORATION
}

enum RewardType {
  SEED
  FERTILIZER
  DECORATION
  XP
}

enum IEPGoalStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
}
